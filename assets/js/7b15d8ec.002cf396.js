"use strict";(self.webpackChunklinkis_web_apache=self.webpackChunklinkis_web_apache||[]).push([[32077],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=i.createContext({}),d=function(e){var n=i.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=d(e.components);return i.createElement(s.Provider,{value:n},e.children)},p="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),p=d(t),m=r,u=p["".concat(s,".").concat(m)]||p[m]||k[m]||o;return t?i.createElement(u,l(l({ref:n},c),{},{components:t})):i.createElement(u,l({ref:n},c))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=m;var a={};for(var s in n)hasOwnProperty.call(n,s)&&(a[s]=n[s]);a.originalType=e,a[p]="string"==typeof e?e:r,l[1]=a;for(var d=2;d<o;d++)l[d]=t[d];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},46628:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>s});var i=t(87462),r=(t(67294),t(3905));const o={title:"linkis Container deployment",sidebar_position:12},l=void 0,a={unversionedId:"deployment/deploy-linkis-to-kbernetes",id:"deployment/deploy-linkis-to-kbernetes",isDocsHomePage:!1,title:"linkis Container deployment",description:"This article describes how to deploy a Linkis service in a Kind Kubernetes environment for easier learning and debugging.",source:"@site/docs/deployment/deploy-linkis-to-kbernetes.md",sourceDirName:"deployment",slug:"/deployment/deploy-linkis-to-kbernetes",permalink:"/docs/1.3.0/deployment/deploy-linkis-to-kbernetes",editUrl:"https://github.com/apache/incubator-linkis-website/edit/dev/docs/deployment/deploy-linkis-to-kbernetes.md",tags:[],version:"current",sidebarPosition:12,frontMatter:{title:"linkis Container deployment",sidebar_position:12},sidebar:"tutorialSidebar",previous:{title:"Involve Prometheus",permalink:"/docs/1.3.0/deployment/involve-prometheus-into-linkis"},next:{title:"Involve Knife4j",permalink:"/docs/1.3.0/deployment/involve-knife4j-into-linkis"}},s=[{value:"1. Dependencies and versions",id:"1-dependencies-and-versions",children:[{value:"versions:",id:"versions",children:[]},{value:"notice\uff1a",id:"notice",children:[]}]},{value:"2.Install the docker",id:"2install-the-docker",children:[{value:"2.1 Install the tutorial",id:"21-install-the-tutorial",children:[]},{value:"2.2 Setting a Domestic Image",id:"22-setting-a-domestic-image",children:[]}]},{value:"3. Install the kind",id:"3-install-the-kind",children:[{value:"\uff081\uff09Manually download the kind binary",id:"1manually-download-the-kind-binary",children:[]},{value:"\uff082\uff09Install kind Binary",id:"2install-kind-binary",children:[]}]},{value:"4. Install linkis",id:"4-install-linkis",children:[{value:"0.Download linkis1.3.0 deployment package",id:"0download-linkis130-deployment-package",children:[]},{value:"1.Build directory",id:"1build-directory",children:[]},{value:"2.Copy driver to /opt/data/common/extendlib",id:"2copy-driver-to-optdatacommonextendlib",children:[]},{value:"3.Reset kind (not necessary)",id:"3reset-kind-not-necessary",children:[]},{value:"4.Pull the image",id:"4pull-the-image",children:[]},{value:"5.Install linkis to kind",id:"5install-linkis-to-kind",children:[]},{value:"6.Run commands to view services and wait until all services are successfully started",id:"6run-commands-to-view-services-and-wait-until-all-services-are-successfully-started",children:[]},{value:"7.Copy the ldh environment to linkis",id:"7copy-the-ldh-environment-to-linkis",children:[]},{value:"8.Enabling Port Mapping",id:"8enabling-port-mapping",children:[]},{value:"9.Access to the system",id:"9access-to-the-system",children:[]},{value:"10.Into the container",id:"10into-the-container",children:[]}]}],d={toc:s};function c(e){let{components:n,...o}=e;return(0,r.kt)("wrapper",(0,i.Z)({},d,o,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This article describes how to deploy a Linkis service in a Kind Kubernetes environment for easier learning and debugging."),(0,r.kt)("h2",{id:"1-dependencies-and-versions"},"1. Dependencies and versions"),(0,r.kt)("p",null,"kind github\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/kind"},"https://github.com/kubernetes-sigs/kind"),(0,r.kt)("br",{parentName:"p"}),"\n","kind web site\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://kind.sigs.k8s.io/"},"kind.sigs.k8s.io/")),(0,r.kt)("h3",{id:"versions"},"versions:"),(0,r.kt)("p",null,"kind 0.14.0",(0,r.kt)("br",{parentName:"p"}),"\n","docker 20.10.17",(0,r.kt)("br",{parentName:"p"}),"\n","centos 7.6",(0,r.kt)("br",{parentName:"p"}),"\n","helm 3.x  "),(0,r.kt)("h3",{id:"notice"},"notice\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Ensure that the component depends on the version",(0,r.kt)("br",{parentName:"li"}),"2.kind means that the machine simulating node with docker container is restarted and the container has changed and the scheduler is not working anymore. This is a kind limitation and there is a detailed explanation in the official document.")),(0,r.kt)("h2",{id:"2install-the-docker"},"2.Install the docker"),(0,r.kt)("h3",{id:"21-install-the-tutorial"},"2.1 Install the tutorial"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo yum install -y yum-utils device-mapper-persistent-data lvm2\nsudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo sed -i 's+download.docker.com+mirrors.aliyun.com/docker-ce+' /etc/yum.repos.d/docker-ce.repo\nsudo yum makecache fast\nsudo yum -y install docker-ce\nsystemctl start docker\nsystemctl enable docker\n")),(0,r.kt)("h3",{id:"22-setting-a-domestic-image"},"2.2 Setting a Domestic Image"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'vi /etc/docker/daemon.json\n{\n"registry-mirrors": ["http://hub-mirror.c.163.com"],\n"insecure-registries": ["https://registry.mydomain.com","http://hub-mirror.c.163.com"]\n}\n')),(0,r.kt)("h2",{id:"3-install-the-kind"},"3. Install the kind"),(0,r.kt)("h3",{id:"1manually-download-the-kind-binary"},"\uff081\uff09Manually download the kind binary"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://github.com/kubernetes-sigs/kind/releases\n")),(0,r.kt)("h3",{id:"2install-kind-binary"},"\uff082\uff09Install kind Binary"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"chmod +x ./kind\nmv kind-linux-amd64 /usr/bin/kind\n")),(0,r.kt)("h2",{id:"4-install-linkis"},"4. Install linkis"),(0,r.kt)("h3",{id:"0download-linkis130-deployment-package"},"0.Download linkis1.3.0 deployment package"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"apache-linkis-1.3.0-incubating-bin.tar.gz\n")),(0,r.kt)("h3",{id:"1build-directory"},"1.Build directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir -p /opt/data/common/extendlib\n")),(0,r.kt)("h3",{id:"2copy-driver-to-optdatacommonextendlib"},"2.Copy driver to /opt/data/common/extendlib"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"curl https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.28/mysql-connector-java-8.0.28.jar -o /opt/data/common/extendlib/[mysql-connector-java-8.0.28.jar](https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.28/mysql-connector-java-8.0.28.jar)\n")),(0,r.kt)("h3",{id:"3reset-kind-not-necessary"},"3.Reset kind (not necessary)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./bin/install-linkis-to-kubernetes.sh reset\n")),(0,r.kt)("h3",{id:"4pull-the-image"},"4.Pull the image"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./bin/install-linkis-to-kubernetes.sh pull -mghcr.dockerproxy.com\n")),(0,r.kt)("h3",{id:"5install-linkis-to-kind"},"5.Install linkis to kind"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./bin/install-linkis-to-kubernetes.sh install -l -mghcr.dockerproxy.com\n")),(0,r.kt)("h3",{id:"6run-commands-to-view-services-and-wait-until-all-services-are-successfully-started"},"6.Run commands to view services and wait until all services are successfully started"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl get pods -A\n")),(0,r.kt)("p",null,(0,r.kt)("img",{src:t(37840).Z})),(0,r.kt)("h3",{id:"7copy-the-ldh-environment-to-linkis"},"7.Copy the ldh environment to linkis"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./helm/scripts/prepare-for-spark.sh\n")),(0,r.kt)("h3",{id:"8enabling-port-mapping"},"8.Enabling Port Mapping"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./helm/scripts/remote-proxy.sh start\n")),(0,r.kt)("h3",{id:"9access-to-the-system"},"9.Access to the system"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"linkis-web: http://10.0.2.101:8088/\neureka: http://10.0.2.101:20303/\n")),(0,r.kt)("h3",{id:"10into-the-container"},"10.Into the container"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'./helm/scripts/login-pod.sh cg-engineconnmanager\nExecuting shell tests\nsh ./bin/linkis-cli -engineType shell-1 -codeType shell -code "echo "hello" "  -submitUser hadoop -proxyUser hadoop\nExecuting hive Tests\nsh ./bin/linkis-cli -engineType hive-2.3.3 -codeType hql -code "show tables"  -submitUser hadoop -proxyUser hadoop\nExecuting spark Tests\nsh ./bin/linkis-cli -engineType spark-2.4.3 -codeType sql -code "show tables"  -submitUser hadoop -proxyUser hadoop\nExecuting python Tests\nsh ./bin/linkis-cli -engineType python-python2 -codeType python -code "print(\\"hello\\")"  -submitUser hadoop -proxyUser hadoop  -confMap  python.version=python\n')),(0,r.kt)("p",null,(0,r.kt)("img",{src:t(99359).Z})))}c.isMDXComponent=!0},99359:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/linkis-37fe8c9f4209ea07542c9ab7e1a89f7a.jpg"},37840:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/pods-df2553c9e0c1a61bb73bd5f17033e63e.jpg"}}]);